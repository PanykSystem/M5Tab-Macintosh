; PlatformIO Project Configuration File
; BasiliskII ESP32 - Macintosh Emulator for M5Stack Tab5
;
; Build options: build flags, source filter
; Upload options: custom upload port, speed and extra flags
; Library options: dependencies, extra library storages

[env:esp32p4_pioarduino]
platform = https://github.com/pioarduino/platform-espressif32.git#54.03.21
upload_speed = 1500000
monitor_speed = 115200
build_type = release
framework = arduino
board = esp32-p4-evboard
board_build.mcu = esp32p4
board_build.flash_mode = qio

; Pre-build scripts to fix toolchain PATH
extra_scripts =
    pre:scripts/add_toolchain_path.py
    pre:scripts/pre_build.py

; Build flags for BasiliskII
build_flags =
    -DBOARD_HAS_PSRAM
    -DCORE_DEBUG_LEVEL=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    ; Optimize for size
    -Os
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
    ; BasiliskII configuration
    -DEMULATED_68K=1
    -DREAL_ADDRESSING=0
    -DDIRECT_ADDRESSING=0
    -DROM_IS_WRITE_PROTECTED=1
    -DNO_STD_NAMESPACE
    ; Data type sizes for ESP32 (32-bit RISC-V)
    -DSIZEOF_SHORT=2
    -DSIZEOF_INT=4
    -DSIZEOF_LONG=4
    -DSIZEOF_LONG_LONG=8
    -DSIZEOF_VOID_P=4
    ; FPU configuration
    -DFPU_IEEE=1
    -DFPU_UAE=0
    ; Disable features not available on ESP32
    -DENABLE_MON=0
    -DUSE_JIT=0
    ; Include paths
    -I src/basilisk
    -I src/basilisk/include
    -I src/basilisk/uae_cpu
    ; Compiler warnings
    -Wno-unused-variable
    -Wno-unused-function
    -Wno-unused-but-set-variable
    -Wno-sign-compare
    -Wno-missing-field-initializers
    -Wno-return-type
    -Wno-deprecated-enum-enum-conversion

; Source filter - include basilisk sources
build_src_filter =
    +<*>
    +<basilisk/*.cpp>
    +<basilisk/uae_cpu/*.cpp>

lib_deps =
    https://github.com/M5Stack/M5Unified.git
    https://github.com/M5Stack/M5GFX.git
